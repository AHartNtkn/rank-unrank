import {permUnrank, permRank, permCard, permLenError, permUnqError} from './permutations.js'
import {negElemError, bigElemError, negFinError} from '../errors.js'
import {bigRankError, negRankError} from '../../genericErrors.js'

test('Verifying error instances of permUnrank', () => {
  expect(() => {
    permUnrank(-10n, 100n)
  }).toThrow(negFinError)

  expect(() => {
    permUnrank(10n, -100n)
  }).toThrow(negRankError)

  expect(() => {
    permUnrank(10n, 3628800n)
  }).toThrow(bigRankError)
})

test('Verifying error instances of permRank', () => {
  expect(() => {
    permRank(-10n, [ 0n, 1n, 2n, 3n, 4n, 5n, 6n, 7n, 8n, 9n ])
  }).toThrow(negFinError)

  expect(() => {
    permRank(10n, [ 0n, 1n, 2n, 3n, 4n, 5n, 6n, 7n, 9n ])
  }).toThrow(permLenError)

  expect(() => {
    permRank(10n, [ 0n, 1n, 2n, 3n, -4n, 5n, 6n, 7n, 8n, 9n ])
  }).toThrow(negElemError)

  expect(() => {
    permRank(10n, [ 0n, 1n, 2n, 3n, 4n, 5n, 6n, 7n, 8n, 10n ])
  }).toThrow(bigElemError)

  expect(() => {
    permRank(10n, [ 0n, 1n, 2n, 3n, 4n, 5n, 6n, 7n, 8n, 8n ])
  }).toThrow(permUnqError)

})

test('Verifying for some small values that permRank and permUnrank are inverses.', () => {
  for(let i=0n; i<=7n; i++) {
  for(let j=0n; j<permCard(i);j++) {
    expect(permRank(i,permUnrank(i,j)).toString()
    ).toBe(j.toString())
  }}
})

test('Verifying for several values that permRank and permUnrank are inverses.', () => {
  expect(permRank(31n,permUnrank(31n,
  7242286950025083013619576214670044n)).toString()
  ).toBe(7242286950025083013619576214670044n.toString())

  expect(permRank(1n,permUnrank(1n,
  0n)).toString()
  ).toBe(0n.toString())

  expect(permRank(94n,permUnrank(94n,
  39374127029026386360670747404018503736558887166597543760719396059442782182482846140824314415085207272341598101345933407157006827792729435168392258n)).toString()
  ).toBe(39374127029026386360670747404018503736558887166597543760719396059442782182482846140824314415085207272341598101345933407157006827792729435168392258n.toString())

  expect(permRank(49n,permUnrank(49n,
  264209741073180006575825677208825289940223062468195686993681927n)).toString()
  ).toBe(264209741073180006575825677208825289940223062468195686993681927n.toString())

  expect(permRank(97n,permUnrank(97n,
  48305892431077523285648794108760945149799611427652965407898138741034210804365844815235032717329542492848875564536190352378872638893676915087636370855025n)).toString()
  ).toBe(48305892431077523285648794108760945149799611427652965407898138741034210804365844815235032717329542492848875564536190352378872638893676915087636370855025n.toString())

  expect(permRank(87n,permUnrank(87n,
  1964607840659028767975451131255150060030353171833525693849853789550090446649995280763380553842862911257375823151943739886999897442982n)).toString()
  ).toBe(1964607840659028767975451131255150060030353171833525693849853789550090446649995280763380553842862911257375823151943739886999897442982n.toString())

  expect(permRank(45n,permUnrank(45n,
  101786325299060974506895723036190432408565317350614768642n)).toString()
  ).toBe(101786325299060974506895723036190432408565317350614768642n.toString())

  expect(permRank(66n,permUnrank(66n,
  479386077540806251968867483102697767116839222870285141682483931880784219572565091169313348677n)).toString()
  ).toBe(479386077540806251968867483102697767116839222870285141682483931880784219572565091169313348677n.toString())

  expect(permRank(7n,permUnrank(7n,
  579n)).toString()
  ).toBe(579n.toString())

  expect(permRank(34n,permUnrank(34n,
  235247461933313379763351822223498106559n)).toString()
  ).toBe(235247461933313379763351822223498106559n.toString())

  expect(permRank(42n,permUnrank(42n,
  790047054099688946808298729463642087967496768749673n)).toString()
  ).toBe(790047054099688946808298729463642087967496768749673n.toString())

  expect(permRank(54n,permUnrank(54n,
  133625021153773384575575138907394627616626218253238318282261220920775300n)).toString()
  ).toBe(133625021153773384575575138907394627616626218253238318282261220920775300n.toString())

  expect(permRank(11n,permUnrank(11n,
  1039846n)).toString()
  ).toBe(1039846n.toString())

  expect(permRank(69n,permUnrank(69n,
  124162188529366265272477617997331722976992905552349729406410378954793356325720101782731402697581973n)).toString()
  ).toBe(124162188529366265272477617997331722976992905552349729406410378954793356325720101782731402697581973n.toString())

  expect(permRank(80n,permUnrank(80n,
  66030683080822800753849545342000977280795179378696923995695731704877832934913903816344817075687831819407095009401490685n)).toString()
  ).toBe(66030683080822800753849545342000977280795179378696923995695731704877832934913903816344817075687831819407095009401490685n.toString())

  expect(permRank(40n,permUnrank(40n,
  618458024607474136612024605759175604388182318522n)).toString()
  ).toBe(618458024607474136612024605759175604388182318522n.toString())

  expect(permRank(52n,permUnrank(52n,
  38946936430298794161758240325977958013207198442788318398663054243036n)).toString()
  ).toBe(38946936430298794161758240325977958013207198442788318398663054243036n.toString())

  expect(permRank(11n,permUnrank(11n,
  38671446n)).toString()
  ).toBe(38671446n.toString())

  expect(permRank(81n,permUnrank(81n,
  935157704978686804706250725318598767899372315303851801050872894717066121650791426522442291510501489489466146925022394720n)).toString()
  ).toBe(935157704978686804706250725318598767899372315303851801050872894717066121650791426522442291510501489489466146925022394720n.toString())

  expect(permRank(30n,permUnrank(30n,
  196483704252087841328214013869695n)).toString()
  ).toBe(196483704252087841328214013869695n.toString())

  expect(permRank(13n,permUnrank(13n,
  1444452102n)).toString()
  ).toBe(1444452102n.toString())

  expect(permRank(96n,permUnrank(96n,
  336627115478676253257296093714776355004637272262161715458382753991743111328316012645124896310413286665367724239698341893535636265597405378164702022242n)).toString()
  ).toBe(336627115478676253257296093714776355004637272262161715458382753991743111328316012645124896310413286665367724239698341893535636265597405378164702022242n.toString())

  expect(permRank(67n,permUnrank(67n,
  10661249202794678451457646271459281788009081452663027845358754710831064785471613412520814453011n)).toString()
  ).toBe(10661249202794678451457646271459281788009081452663027845358754710831064785471613412520814453011n.toString())

  expect(permRank(96n,permUnrank(96n,
  390498793126418106613208639045481475968527660743360072871088676060004721647947435395971918849862890654378302470429454085680843312561998244054578218168n)).toString()
  ).toBe(390498793126418106613208639045481475968527660743360072871088676060004721647947435395971918849862890654378302470429454085680843312561998244054578218168n.toString())

  expect(permRank(100n,permUnrank(100n,
  76144488678520075868211247068224225038775874395737374568633919365398541538002806966264088838027775294427200087390866374394096926756642705853290800480047286862n)).toString()
  ).toBe(76144488678520075868211247068224225038775874395737374568633919365398541538002806966264088838027775294427200087390866374394096926756642705853290800480047286862n.toString())

  expect(permRank(46n,permUnrank(46n,
  4797320469971016426154864784912049716053111951390504463700n)).toString()
  ).toBe(4797320469971016426154864784912049716053111951390504463700n.toString())

  expect(permRank(66n,permUnrank(66n,
  455089253833802552012210823416270435063311334060482980112980757398288625504658582602308103184n)).toString()
  ).toBe(455089253833802552012210823416270435063311334060482980112980757398288625504658582602308103184n.toString())

  expect(permRank(80n,permUnrank(80n,
  18744744055186405278532929371549530691142192852628492414949223193987756075266796925661086990962463330595219722825230265n)).toString()
  ).toBe(18744744055186405278532929371549530691142192852628492414949223193987756075266796925661086990962463330595219722825230265n.toString())

  expect(permRank(88n,permUnrank(88n,
  149055154922415768709096661474787603302147691854892437392399818327133044504200418534817834696307128424389022414541268299473999834145185n)).toString()
  ).toBe(149055154922415768709096661474787603302147691854892437392399818327133044504200418534817834696307128424389022414541268299473999834145185n.toString())

  expect(permRank(49n,permUnrank(49n,
  111441594883101628867162986002230724278089933644267401231448101n)).toString()
  ).toBe(111441594883101628867162986002230724278089933644267401231448101n.toString())

  expect(permRank(98n,permUnrank(98n,
  4280566241194250502381964672428841086844315552090945194230704213997842542719071695957476694124015963882037588260730016542536319724114696467865316554751611n)).toString()
  ).toBe(4280566241194250502381964672428841086844315552090945194230704213997842542719071695957476694124015963882037588260730016542536319724114696467865316554751611n.toString())

  expect(permRank(78n,permUnrank(78n,
  10965628544399440817358283879992695428332566445037491267228959541244595639264089270068987249210761710153829465478515n)).toString()
  ).toBe(10965628544399440817358283879992695428332566445037491267228959541244595639264089270068987249210761710153829465478515n.toString())

  expect(permRank(73n,permUnrank(73n,
  3555589458468942870726780152482409553699194163263856373560329999971378663219665182593294960580919341917151n)).toString()
  ).toBe(3555589458468942870726780152482409553699194163263856373560329999971378663219665182593294960580919341917151n.toString())

  expect(permRank(3n,permUnrank(3n,
  0n)).toString()
  ).toBe(0n.toString())

  expect(permRank(13n,permUnrank(13n,
  5434914807n)).toString()
  ).toBe(5434914807n.toString())

  expect(permRank(37n,permUnrank(37n,
  7093422880136899539777687122792066978752786n)).toString()
  ).toBe(7093422880136899539777687122792066978752786n.toString())

  expect(permRank(76n,permUnrank(76n,
  93863854323903367330387231259516046513111667856468726969245902850550068239686914101682239197812076908952149605n)).toString()
  ).toBe(93863854323903367330387231259516046513111667856468726969245902850550068239686914101682239197812076908952149605n.toString())

  expect(permRank(46n,permUnrank(46n,
  4669765500237979179049254889394316761222419523580614980309n)).toString()
  ).toBe(4669765500237979179049254889394316761222419523580614980309n.toString())

  expect(permRank(18n,permUnrank(18n,
  2420982121074792n)).toString()
  ).toBe(2420982121074792n.toString())

  expect(permRank(23n,permUnrank(23n,
  15883819386802821309992n)).toString()
  ).toBe(15883819386802821309992n.toString())

  expect(permRank(71n,permUnrank(71n,
  651067118599744545241257639869107366853803916472861835018764851835522555827187650779523444867430589981n)).toString()
  ).toBe(651067118599744545241257639869107366853803916472861835018764851835522555827187650779523444867430589981n.toString())

  expect(permRank(96n,permUnrank(96n,
  40587170191429568972833028541865235724977628293273471776234634273619867576163972118919773847234392649817083346966703207870097111636331307549595514872n)).toString()
  ).toBe(40587170191429568972833028541865235724977628293273471776234634273619867576163972118919773847234392649817083346966703207870097111636331307549595514872n.toString())

  expect(permRank(24n,permUnrank(24n,
  17442136142602304812662n)).toString()
  ).toBe(17442136142602304812662n.toString())

  expect(permRank(63n,permUnrank(63n,
  1431627771648748231362619948078501467660083332445982670987333092443208158114625907132054n)).toString()
  ).toBe(1431627771648748231362619948078501467660083332445982670987333092443208158114625907132054n.toString())

  expect(permRank(78n,permUnrank(78n,
  2373638398212186058663086371446509550579317590804611212058802845287239988401681371506489452631237044698267611120301n)).toString()
  ).toBe(2373638398212186058663086371446509550579317590804611212058802845287239988401681371506489452631237044698267611120301n.toString())

  expect(permRank(88n,permUnrank(88n,
  118730296610019663047510481503534904169474566948841084365294159343528867496283666204791818426940883885546524684257335589825735879529341n)).toString()
  ).toBe(118730296610019663047510481503534904169474566948841084365294159343528867496283666204791818426940883885546524684257335589825735879529341n.toString())

  expect(permRank(67n,permUnrank(67n,
  15517740306419382115998224270053296731420527425443679533421474808292829637988783594969527846340n)).toString()
  ).toBe(15517740306419382115998224270053296731420527425443679533421474808292829637988783594969527846340n.toString())

  expect(permRank(60n,permUnrank(60n,
  460104873096644170244674008056284554706754483299631191281222440218772828890059333n)).toString()
  ).toBe(460104873096644170244674008056284554706754483299631191281222440218772828890059333n.toString())

  expect(permRank(100n,permUnrank(100n,
  18933930686716041874133868045607754678763549446639632044928692484531965895395007240939895430742105102595435272630625746210081792671572234400676539795771051702n)).toString()
  ).toBe(18933930686716041874133868045607754678763549446639632044928692484531965895395007240939895430742105102595435272630625746210081792671572234400676539795771051702n.toString())

  expect(permRank(8n,permUnrank(8n,
  1103n)).toString()
  ).toBe(1103n.toString())

  expect(permRank(56n,permUnrank(56n,
  688442435606133510597543169568263285362586213205372370548456839378755925430n)).toString()
  ).toBe(688442435606133510597543169568263285362586213205372370548456839378755925430n.toString())

  expect(permRank(81n,permUnrank(81n,
  3319775918878432863417924341834946529368943151382080005600210023615919111977421731429936019062839159230086660469246556788n)).toString()
  ).toBe(3319775918878432863417924341834946529368943151382080005600210023615919111977421731429936019062839159230086660469246556788n.toString())

  expect(permRank(94n,permUnrank(94n,
  89833546583724041915630706472152545881419427919083178699246492518372575409472307699243487919844434955503300280126108041982151315801108463697780697n)).toString()
  ).toBe(89833546583724041915630706472152545881419427919083178699246492518372575409472307699243487919844434955503300280126108041982151315801108463697780697n.toString())

  expect(permRank(94n,permUnrank(94n,
  58425335152345540885419358445982053312564732281321093742504183363160748202400404089229630764206974252445159921415846509769955872117650624400746918n)).toString()
  ).toBe(58425335152345540885419358445982053312564732281321093742504183363160748202400404089229630764206974252445159921415846509769955872117650624400746918n.toString())

  expect(permRank(41n,permUnrank(41n,
  8719964159049023716926336265992060390584157157732n)).toString()
  ).toBe(8719964159049023716926336265992060390584157157732n.toString())

  expect(permRank(92n,permUnrank(92n,
  6811278926547162414077643037742822359383551180254509222913356391296144814243868087171815479574413522890791337663188141690940051850550161415536n)).toString()
  ).toBe(6811278926547162414077643037742822359383551180254509222913356391296144814243868087171815479574413522890791337663188141690940051850550161415536n.toString())

  expect(permRank(15n,permUnrank(15n,
  1253298993348n)).toString()
  ).toBe(1253298993348n.toString())

  expect(permRank(100n,permUnrank(100n,
  82247229469627361775083030568141255389217074908303243053107300044533989789557661603488978593917236950765656555230851605419735669916438269918507144702351758806n)).toString()
  ).toBe(82247229469627361775083030568141255389217074908303243053107300044533989789557661603488978593917236950765656555230851605419735669916438269918507144702351758806n.toString())

  expect(permRank(72n,permUnrank(72n,
  11993569060044896136510153064878455492890059894275076970620631442507509086419341582152425317740771066412n)).toString()
  ).toBe(11993569060044896136510153064878455492890059894275076970620631442507509086419341582152425317740771066412n.toString())

  expect(permRank(55n,permUnrank(55n,
  4309778756798006430407445286620366620295663752653455996268934355165216057n)).toString()
  ).toBe(4309778756798006430407445286620366620295663752653455996268934355165216057n.toString())

  expect(permRank(36n,permUnrank(36n,
  135527747078868558983185205945443358486831n)).toString()
  ).toBe(135527747078868558983185205945443358486831n.toString())

  expect(permRank(55n,permUnrank(55n,
  4727485801454398902956844735873814169297516867940326451112542665901355572n)).toString()
  ).toBe(4727485801454398902956844735873814169297516867940326451112542665901355572n.toString())

  expect(permRank(63n,permUnrank(63n,
  157725916732910046990085652080929080492718271989951609384076170163704993674103782672704n)).toString()
  ).toBe(157725916732910046990085652080929080492718271989951609384076170163704993674103782672704n.toString())

  expect(permRank(2n,permUnrank(2n,
  1n)).toString()
  ).toBe(1n.toString())

  expect(permRank(22n,permUnrank(22n,
  578106479237729863822n)).toString()
  ).toBe(578106479237729863822n.toString())

  expect(permRank(3n,permUnrank(3n,
  0n)).toString()
  ).toBe(0n.toString())

  expect(permRank(97n,permUnrank(97n,
  2885367961666850837896349527766057349123666119100864528765236312407910341940956737061616527336116764539124238875737921005815545961675140080210567072352n)).toString()
  ).toBe(2885367961666850837896349527766057349123666119100864528765236312407910341940956737061616527336116764539124238875737921005815545961675140080210567072352n.toString())

  expect(permRank(36n,permUnrank(36n,
  111225676423289360518214494457475856646820n)).toString()
  ).toBe(111225676423289360518214494457475856646820n.toString())

  expect(permRank(24n,permUnrank(24n,
  94595814856970351966131n)).toString()
  ).toBe(94595814856970351966131n.toString())

  expect(permRank(11n,permUnrank(11n,
  1163170n)).toString()
  ).toBe(1163170n.toString())

  expect(permRank(5n,permUnrank(5n,
  47n)).toString()
  ).toBe(47n.toString())

  expect(permRank(94n,permUnrank(94n,
  72113311038394436371973797727917214949314364276934131329038567326832415063025923507548630636596844561259352033766291702236577021228318267068011123n)).toString()
  ).toBe(72113311038394436371973797727917214949314364276934131329038567326832415063025923507548630636596844561259352033766291702236577021228318267068011123n.toString())

  expect(permRank(52n,permUnrank(52n,
  45019039970147882314952547749664915806443896418853409985974682828084n)).toString()
  ).toBe(45019039970147882314952547749664915806443896418853409985974682828084n.toString())

  expect(permRank(13n,permUnrank(13n,
  1676756179n)).toString()
  ).toBe(1676756179n.toString())

  expect(permRank(67n,permUnrank(67n,
  17928974873036322475572546681728063913693998886207899102314550843242361450926265422277742984003n)).toString()
  ).toBe(17928974873036322475572546681728063913693998886207899102314550843242361450926265422277742984003n.toString())

  expect(permRank(39n,permUnrank(39n,
  19228551068796139720122829871560368366888950874n)).toString()
  ).toBe(19228551068796139720122829871560368366888950874n.toString())

  expect(permRank(22n,permUnrank(22n,
  552613105862121331663n)).toString()
  ).toBe(552613105862121331663n.toString())

  expect(permRank(82n,permUnrank(82n,
  10436120447033461404127782913481044617226248364871609197671885120510236902953712966988252121006719857572274775009261925152n)).toString()
  ).toBe(10436120447033461404127782913481044617226248364871609197671885120510236902953712966988252121006719857572274775009261925152n.toString())

  expect(permRank(46n,permUnrank(46n,
  3107660313618290152073126790554502284886518416916058755113n)).toString()
  ).toBe(3107660313618290152073126790554502284886518416916058755113n.toString())

  expect(permRank(57n,permUnrank(57n,
  33643493709070729091253414779165433826958475198724865430594429169633133433785n)).toString()
  ).toBe(33643493709070729091253414779165433826958475198724865430594429169633133433785n.toString())

  expect(permRank(99n,permUnrank(99n,
  72897679075466006409308620525986133765803950813155355677633027728236700732863074369017838487411077020245787577676476434208432478317710551547276882431623345n)).toString()
  ).toBe(72897679075466006409308620525986133765803950813155355677633027728236700732863074369017838487411077020245787577676476434208432478317710551547276882431623345n.toString())

  expect(permRank(37n,permUnrank(37n,
  9912687592673696748116931033470598394460916n)).toString()
  ).toBe(9912687592673696748116931033470598394460916n.toString())

  expect(permRank(91n,permUnrank(91n,
  123550559002974186265058716808592221053506387133461461251305319889016537668252170461117488997578996710500941481688817812322829457150940625013n)).toString()
  ).toBe(123550559002974186265058716808592221053506387133461461251305319889016537668252170461117488997578996710500941481688817812322829457150940625013n.toString())

  expect(permRank(58n,permUnrank(58n,
  904414367501325440943825656781043864497403871953706560025585815689354393468269n)).toString()
  ).toBe(904414367501325440943825656781043864497403871953706560025585815689354393468269n.toString())

  expect(permRank(69n,permUnrank(69n,
  10533140660541115698388396922026680224244549192476573860426809043441219455738332949604327152964829n)).toString()
  ).toBe(10533140660541115698388396922026680224244549192476573860426809043441219455738332949604327152964829n.toString())

  expect(permRank(10n,permUnrank(10n,
  2223829n)).toString()
  ).toBe(2223829n.toString())

  expect(permRank(25n,permUnrank(25n,
  521426274376036324258626n)).toString()
  ).toBe(521426274376036324258626n.toString())

  expect(permRank(8n,permUnrank(8n,
  24864n)).toString()
  ).toBe(24864n.toString())

  expect(permRank(93n,permUnrank(93n,
  268638225449061001847775655238162158966380398062380830326321034569624535953064024337263932243716999303969986475779957904123483462478549748085778n)).toString()
  ).toBe(268638225449061001847775655238162158966380398062380830326321034569624535953064024337263932243716999303969986475779957904123483462478549748085778n.toString())

  expect(permRank(3n,permUnrank(3n,
  2n)).toString()
  ).toBe(2n.toString())

  expect(permRank(92n,permUnrank(92n,
  6870307850125806595235115104540532456624090678536550631666579544791515443809823764181848397125157148676896287905035818146052711387346821884457n)).toString()
  ).toBe(6870307850125806595235115104540532456624090678536550631666579544791515443809823764181848397125157148676896287905035818146052711387346821884457n.toString())

  expect(permRank(74n,permUnrank(74n,
  204024916046461434566422803373687774337425308458368773155769781453869196401898802304817093250237522258156735n)).toString()
  ).toBe(204024916046461434566422803373687774337425308458368773155769781453869196401898802304817093250237522258156735n.toString())

  expect(permRank(38n,permUnrank(38n,
  130474015979546929509272668011009251097507611n)).toString()
  ).toBe(130474015979546929509272668011009251097507611n.toString())

  expect(permRank(7n,permUnrank(7n,
  476n)).toString()
  ).toBe(476n.toString())

  expect(permRank(62n,permUnrank(62n,
  15164134845583662348822903305345529562479040564220051313607903511504412321689284496688n)).toString()
  ).toBe(15164134845583662348822903305345529562479040564220051313607903511504412321689284496688n.toString())

  expect(permRank(13n,permUnrank(13n,
  3578053938n)).toString()
  ).toBe(3578053938n.toString())

  expect(permRank(56n,permUnrank(56n,
  4475119842886454098770426992974667722132542213974574306429479112802264791n)).toString()
  ).toBe(4475119842886454098770426992974667722132542213974574306429479112802264791n.toString())

  expect(permRank(82n,permUnrank(82n,
  312612180780838430411500655104427279652292353060433121193534156164676865543841628458032731159001516814076153080043418466745n)).toString()
  ).toBe(312612180780838430411500655104427279652292353060433121193534156164676865543841628458032731159001516814076153080043418466745n.toString())

  expect(permRank(10n,permUnrank(10n,
  1496675n)).toString()
  ).toBe(1496675n.toString())

  expect(permRank(66n,permUnrank(66n,
  264847975755075916579497888449551616513307349581726996884172267971664415883179884572448235070n)).toString()
  ).toBe(264847975755075916579497888449551616513307349581726996884172267971664415883179884572448235070n.toString())
})